# 🛡️ 数据保护系统使用说明

## 重要：请仔细阅读以保护您的宝贵数据！

---

## 🚀 快速开始

### 日常使用流程：
1. **启动自动备份服务**：双击 `启动自动备份.bat`（保持窗口开启）
2. **启动服务器**：正常启动服务器
3. **使用应用**：正常使用你的娃柜应用
4. **重要操作前**：双击 `立即备份.bat` 手动备份

---

## 📁 文件说明

### 批处理文件（双击即可使用）
- **立即备份.bat** - 立即创建一个手动备份
- **启动自动备份.bat** - 启动自动备份服务（每小时备份一次）
- **检查数据安全.bat** - 检查当前数据状态和备份情况
- **恢复数据库.bat** - 从备份恢复数据（谨慎使用）

### 核心文件
- **server/doll_collection.db** - 主数据库文件（最重要！）
- **server/backups/** - 备份文件夹（自动创建）

---

## 🔒 数据保护措施

### 1. 自动备份
- 间隔：每小时自动备份一次
- 保留：最近30个备份文件
- 命名：`backup_auto_时间戳.db`

### 2. 手动备份
- 使用场景：重要操作前、添加大量数据后
- 命名：`backup_manual_时间戳.db`

### 3. 备份验证
- 每次备份后自动验证数据完整性
- 显示娃头、娃体、衣柜物品数量

---

## 📋 使用建议

### ✅ 推荐做法：
1. **每天首次使用前**：运行一次手动备份
2. **添加新娃后**：立即手动备份
3. **批量修改前**：先手动备份
4. **长时间使用**：保持自动备份服务开启

### ❌ 避免做法：
1. 不要直接删除或修改 `.db` 文件
2. 不要在服务器运行时恢复数据库
3. 不要删除 backups 文件夹

---

## 🆘 数据恢复步骤

如果数据出现问题：

1. **停止所有服务**
   - 关闭服务器
   - 关闭自动备份服务

2. **运行恢复工具**
   - 双击 `恢复数据库.bat`
   - 选择要恢复的备份
   - 确认恢复

3. **重启服务**
   - 重新启动服务器
   - 重新启动自动备份

---

## 📊 备份文件管理

### 文件位置
```
server/
  └── backups/
      ├── backup_auto_2025-08-25T14-30-00.db
      ├── backup_manual_2025-08-25T15-00-00.db
      └── before_restore_2025-08-25T16-00-00.db
```

### 文件类型
- **backup_auto_** - 自动备份
- **backup_manual_** - 手动备份
- **before_restore_** - 恢复前的备份

### 存储空间
- 每个备份约 100-200 KB
- 30个备份约占用 3-6 MB
- 超过30个自动删除最旧的

---

## ⚠️ 紧急情况处理

### 数据丢失：
1. 检查 `server/backups/` 文件夹
2. 运行 `恢复数据库.bat`
3. 选择最近的备份恢复

### 数据损坏：
1. 立即停止服务器
2. 不要尝试修复
3. 直接从备份恢复

### 无法恢复：
1. 检查是否有其他备份位置
2. 尝试更早的备份文件
3. 联系技术支持

---

## 💡 最佳实践

1. **定期检查**：每周运行一次 `检查数据安全.bat`
2. **多重备份**：重要更新后，额外复制备份到其他位置
3. **记录重要操作**：大量修改前记录时间，便于选择恢复点
4. **测试恢复**：偶尔测试恢复功能，确保备份有效

---

## 📞 需要帮助？

如遇到问题：
1. 先查看本说明文档
2. 检查 server/backups 文件夹是否有备份
3. 尝试从最近的备份恢复

记住：**数据安全最重要，宁可多备份也不要冒险！**

---

最后更新：2025-08-25